-- Decompilation Error: _glue_flows(node)

-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
local Definitions = require("scripts/ui/constant_elements/elements/chat/constant_element_chat_definitions")
local ChatManagerConstants = require("scripts/foundation/managers/chat/chat_manager_constants")
local InputUtils = require("scripts/managers/input/input_utils")
local UIRenderer = require("scripts/managers/ui/ui_renderer")
local UIFonts = require("scripts/managers/ui/ui_fonts")
local UIFontSettings = require("scripts/managers/ui/ui_font_settings")
local UIScenegraph = require("scripts/managers/ui/ui_scenegraph")
local UIWidget = require("scripts/managers/ui/ui_widget")
local DefaultViewInputSettings = require("scripts/settings/input/default_view_input_settings")
local ChatSettings = require("scripts/ui/constant_elements/elements/chat/constant_element_chat_settings")
local ColorUtilities = require("scripts/utilities/ui/colors")
local Promise = require("scripts/foundation/utilities/promise")
local XboxLive = require("scripts/foundation/utilities/xbox_live")
local StringVerification = require("scripts/managers/localization/string_verification")
local ConstantElementChat = class("ConstantElementChat", "ConstantElementBase")
local STATE_HIDDEN = "hidden"
local STATE_IDLE = "idle"
local STATE_ACTIVE = "active"

ConstantElementChat.init = function (self, parent, draw_layer, start_scale, definitions)
	ConstantElementChat.super.init(self, parent, draw_layer, start_scale, Definitions)
	Managers.event:register(self, "chat_manager_connected", "cb_chat_manager_connected")
	Managers.event:register(self, "chat_manager_login_state_change", "cb_chat_manager_login_state_change")
	Managers.event:register(self, "chat_manager_added_channel", "cb_chat_manager_added_channel")
	Managers.event:register(self, "chat_manager_removed_channel", "cb_chat_manager_removed_channel")
	Managers.event:register(self, "chat_manager_updated_channel_state", "cb_chat_manager_updated_channel_state")
	Managers.event:register(self, "chat_manager_message_recieved", "cb_chat_manager_message_recieved")
	Managers.event:register(self, "chat_manager_participant_added", "cb_chat_manager_participant_added")
	Managers.event:register(self, "chat_manager_participant_update", "cb_chat_manager_participant_update")
	Managers.event:register(self, "chat_manager_participant_removed", "cb_chat_manager_participant_removed")

	self._message_widget_blueprints = Definitions.message_widget_blueprints
	self._messages = {}
	self._message_widgets = {}
	self._last_message_index = 0
	self._scroll_length_from_top = 0
	self._scroll_extra_vertical_offset = 0
	self._first_visible_chat_message = 0
	self._has_scrolled_back_in_history = false
	self._message_presentation_format = ChatSettings.message_presentation_format .. "{#reset()}"
	self._total_chat_height = 0
	self._removed_height_since_last_frame = 0
	self._channels = {}
	self._connected_channels = {}
	self._num_connected_channels = 0
	self._activate_input_field = false
	self._is_cursor_pushed = false
	self._is_always_visible = ChatSettings.is_always_visible
	self._input_caret = ""
	self._alpha = 0
	self._time_since_last_update = ChatSettings.inactivity_timeout
	self._input_field_widget = nil

	self:_setup_input()

	for channel_handle, channel in pairs(Managers.chat:connected_chat_channels()) do
		self:cb_chat_manager_added_channel(channel_handle, channel)
		self:_on_connect_to_channel(channel_handle)
	end
end

ConstantElementChat.destroy = function (self)
	self:_enable_mouse_cursor(false)
	Managers.event:unregister(self, "chat_manager_connected")
	Managers.event:unregister(self, "chat_manager_login_state_change")
	Managers.event:unregister(self, "chat_manager_added_channel")
	Managers.event:unregister(self, "chat_manager_removed_channel")
	Managers.event:unregister(self, "chat_manager_updated_channel_state")
	Managers.event:unregister(self, "chat_manager_message_recieved")
	Managers.event:unregister(self, "chat_manager_participant_added")
	Managers.event:unregister(self, "chat_manager_participant_update")
	Managers.event:unregister(self, "chat_manager_participant_removed")
end

ConstantElementChat.update = function (self, dt, t, ui_renderer, render_settings, input_service)
	ConstantElementChat.super.update(self, dt, t, ui_renderer, render_settings, input_service)

	local is_visible = self._is_visible

	if is_visible then
		self:_handle_input(input_service, ui_renderer)
	end

	self:_update_message_widgets_sizes(ui_renderer)
	self:_update_scrollbar(render_settings)

	local input_widget = self._input_field_widget
	local is_input_field_active = input_widget.content.is_writing
	local activate_input_field = self._activate_input_field
	local target_state, target_alpha, target_background_alpha_full = nil
	local time_since_last_update = ((activate_input_field or is_input_field_active) and 0) or self._time_since_last_update

	if is_visible then
		self._time_since_last_update = time_since_last_update + dt
	end

	local inactivity_timeout = ChatSettings.inactivity_timeout
	local idle_timeout = ChatSettings.idle_timeout

	if (inactivity_timeout <= time_since_last_update and inactivity_timeout >= 0 and not activate_input_field) or not is_visible then
		target_alpha = 0
		target_background_alpha_full = 0
		target_state = STATE_HIDDEN
	elseif idle_timeout <= time_since_last_update and idle_timeout >= 0 and not activate_input_field then
		target_alpha = ChatSettings.idle_text_alpha / 255
		target_background_alpha_full = ChatSettings.idle_background_alpha
		target_state = STATE_IDLE
	else
		target_alpha = 1
		target_background_alpha_full = ChatSettings.background_color[1]
		target_state = STATE_ACTIVE
	end

	if not self:_is_animation_active(self._chat_window_animation_id) and not self:_is_animation_active(self._input_field_animation_id) then
		if target_state ~= self._active_state or target_alpha ~= self._alpha then
			local params = {
				target_state = target_state,
				target_alpha = target_alpha,
				target_background_alpha = target_background_alpha_full,
				activate_input_field = activate_input_field,
				message_widgets = self._message_widgets
			}
			local speed = (target_state == STATE_HIDDEN and is_visible and ChatSettings.inactive_fade_speed) or 1
			self._chat_window_animation_id = self:_start_animation("fade_chat_window", self._widgets_by_name, params, nil, speed)
			self._input_field_animation_id = self:_start_animation("fade_input_field", self._widgets_by_name, params, nil, speed)
		elseif is_input_field_active ~= activate_input_field then
			local params = {
				target_alpha = target_alpha,
				activate_input_field = activate_input_field
			}
			local speed = 5

			self:_start_animation("fade_input_field", self._widgets_by_name, params, nil, speed)
		end
	end
end

ConstantElementChat.using_input = function (self)
	return self._input_field_widget.content.is_writing and self._is_visible
end

ConstantElementChat.draw = function (self, dt, t, ui_renderer, render_settings, input_service)
	ConstantElementChat.super.draw(self, dt, t, ui_renderer, render_settings, input_service)
end

ConstantElementChat.set_visible = function (self, visible, optional_visibility_parameters)
	ConstantElementChat.super.set_visible(self, visible, optional_visibility_parameters)
	self:_cancel_animations_if_necessary(true)

	local need_to_update_scenegraph = self:_apply_visibility_parameters(optional_visibility_parameters)
	local active_state = self._active_state

	if need_to_update_scenegraph and active_state ~= STATE_HIDDEN then
		local fade_out_params = {
			target_alpha = 0,
			target_background_alpha = 0,
			target_state = active_state,
			activate_input_field = self._activate_input_field,
			message_widgets = self._message_widgets
		}
		local fade_in_params = {
			target_state = active_state,
			target_alpha = (active_state == STATE_IDLE and ChatSettings.idle_text_alpha / 255) or 1,
			target_background_alpha = (active_state == STATE_IDLE and ChatSettings.idle_background_alpha) or ChatSettings.background_color[1],
			activate_input_field = self._activate_input_field,
			message_widgets = self._message_widgets
		}

		local function on_complete_callback()
			self._update_scenegraph = need_to_update_scenegraph
			self._chat_window_animation_id = self:_start_animation("fade_chat_window", self._widgets_by_name, fade_in_params, nil, 1)
			self._input_field_animation_id = self:_start_animation("fade_input_field", self._widgets_by_name, fade_in_params, nil, 1)
		end

		self._chat_window_animation_id = self:_start_animation("fade_chat_window", self._widgets_by_name, fade_out_params, on_complete_callback, 1)
		self._input_field_animation_id = self:_start_animation("fade_input_field", self._widgets_by_name, fade_out_params, nil, 1)
	end

	self._update_scenegraph = self._update_scenegraph or need_to_update_scenegraph
end

ConstantElementChat.should_update = function (self)
	return self._num_connected_channels > 0 and DevParameters.enable_chat_hud
end

ConstantElementChat.should_draw = function (self)
	return (self._is_visible or self._alpha > 0) and self:should_update()
end

ConstantElementChat.cb_chat_manager_login_state_change = function (self, login_state)
	if login_state == ChatManagerConstants.LoginState.LOGGED_IN then
	elseif login_state == ChatManagerConstants.LoginState.LOGGED_OUT then
	end
end

ConstantElementChat.cb_chat_manager_added_channel = function (self, channel_handle, channel)
	self._channels[channel_handle] = channel
end

ConstantElementChat.cb_chat_manager_removed_channel = function (self, channel_handle)
	local channel = self._channels[channel_handle]

	if self._connected_channels[channel.tag] then
		self:_on_disconnect_from_channel(channel_handle)
	end

	self._channels[channel_handle] = nil
end

ConstantElementChat.cb_chat_manager_updated_channel_state = function (self, channel_handle, state)
	if state == ChatManagerConstants.ChannelConnectionState.CONNECTED then
		self:_on_connect_to_channel(channel_handle)
	elseif state == ChatManagerConstants.ChannelConnectionState.DISCONNECTED then
		self:_on_disconnect_from_channel(channel_handle)
	end
end

ConstantElementChat.cb_chat_manager_message_recieved = function (self, channel_handle, participant, message)
	StringVerification.verify(message.message_body):next(function (message_text)
		local channel = self._channels[channel_handle]
		local channel_tag = channel.tag or "placeholder"
		local sender = nil

		if message.is_current_user then
			local channel_name = self:_channel_name(channel_tag)
			sender = Managers.localization:localize("loc_chat_own_player", true, {
				channel_name = channel_name
			})
		else
			sender = participant.displayname
		end

		self:_add_message(message_text, sender, channel_tag)
	end):catch(function (error)
		Log.warning("ConstantElementChat", "Could not verify string, error: %s, string: %s", tostring(error), tostring(message.message_body))
	end)
end

ConstantElementChat.cb_chat_manager_participant_added = function (self, channel_handle, participant)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not participant.is_current_user and not participant.is_text_muted_for_me then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-11, warpins: 1 ---
		local channel = self._channels[channel_handle]
		local channel_tag = channel.tag

		if channel_tag and self._connected_channels[channel_tag] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 16-35, warpins: 1 ---
			local display_name = participant.displayname
			local channel_name = self:_channel_name(channel_tag, true)
			local message = Managers.localization:localize("loc_chat_user_joined_channel", true, {
				channel_name = channel_name,
				display_name = display_name
			})

			self:_add_notification(message)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 36-36, warpins: 5 ---
	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat.cb_chat_manager_participant_update = function (self, channel_handle, participant)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-1, warpins: 1 ---
	return
	--- END OF BLOCK #0 ---



end

ConstantElementChat.cb_chat_manager_participant_removed = function (self, channel_handle, participant_uri, participant)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not participant.is_current_user and not participant.is_text_muted_for_me then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-11, warpins: 1 ---
		local channel = self._channels[channel_handle]
		local channel_tag = channel.tag

		if channel_tag and self._connected_channels[channel_tag] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 16-35, warpins: 1 ---
			local channel_name = self:_channel_name(channel_tag, true)
			local display_name = participant.displayname
			local message = Managers.localization:localize("loc_chat_user_left_channel", true, {
				channel_name = channel_name,
				display_name = display_name
			})

			self:_add_notification(message)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 36-36, warpins: 5 ---
	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat.cb_chat_manager_connected = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-25, warpins: 1 ---
	Managers.backend:authenticate():next(Promise.delay(1)):next(function (_)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if HAS_STEAM then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 4-6, warpins: 1 ---
			return Steam.user_name()
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 7-7, warpins: 0 ---
			--- END OF BLOCK #1 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 8-12, warpins: 1 ---
			if XboxLive.available() then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 13-21, warpins: 1 ---
				return XboxLive.user_id():next(function (user_id)

					-- Decompilation error in this vicinity:
					--- BLOCK #0 1-4, warpins: 1 ---
					return XUser.get_gamertag(user_id)
					--- END OF BLOCK #0 ---



				end)
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 22-26, warpins: 1 ---
				return Promise.rejected({
					message = "Missing platform functions for display name"
				})
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 27-27, warpins: 3 ---
		return
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 28-28, warpins: 2 ---
		--- END OF BLOCK #2 ---



	end):next(function (display_name)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-11, warpins: 1 ---
		local peer_id = Network.peer_id()

		Managers.chat:login(peer_id, display_name)

		return
		--- END OF BLOCK #0 ---



	end):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-9, warpins: 1 ---
		Log.warning("ConstantElementChat", "Could not get display name for chat login: %s", tostring(error))

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #0 ---



end

ConstantElementChat._draw_widgets = function (self, dt, t, input_service, ui_renderer, render_settings)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-15, warpins: 1 ---
	ConstantElementChat.super._draw_widgets(self, dt, t, input_service, ui_renderer, render_settings)
	self:_draw_message_widgets(ui_renderer)

	return
	--- END OF BLOCK #0 ---



end

ConstantElementChat._draw_message_widgets = function (self, ui_renderer)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-17, warpins: 1 ---
	local message_widgets = self._message_widgets
	local spacing = ChatSettings.message_spacing
	local message_vertical_offset = self:scenegraph_size("chat_message_area")[2] + spacing + self._scroll_extra_vertical_offset
	local i = self._first_visible_chat_message
	local last_index = self._last_message_index

	if #message_widgets > 0 then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 18-18, warpins: 2 ---
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 18-43, warpins: 0 ---
		repeat

			-- Decompilation error in this vicinity:
			--- BLOCK #0 18-18, warpins: 2 ---
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 19-21, warpins: 1 ---
			local widget = message_widgets[i]
			local widget_size = widget and widget.content.size

			--- END OF BLOCK #1 ---

			FLOW; TARGET BLOCK #2



			-- Decompilation error in this vicinity:
			--- BLOCK #2 24-25, warpins: 2 ---
			if widget_size then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 26-35, warpins: 1 ---
				message_vertical_offset = message_vertical_offset - (widget_size[2] + spacing)
				widget.offset[2] = message_vertical_offset

				UIWidget.draw(widget, ui_renderer)
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #2 ---

			FLOW; TARGET BLOCK #3



			-- Decompilation error in this vicinity:
			--- BLOCK #3 36-43, warpins: 2 ---
			i = math.index_wrapper(i - 1, #message_widgets)
			--- END OF BLOCK #3 ---



		until i == last_index or message_vertical_offset <= 0
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 47-47, warpins: 3 ---
	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._setup_input = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-19, warpins: 1 ---
	local input_manager = Managers.input
	self._input_manager = input_manager
	local scrollbar_widget = self._widgets_by_name.chat_scrollbar
	scrollbar_widget.style.mouse_scroll.scenegraph_id = "chat_window"
	scrollbar_widget.content.min_thumb_length = 0.05
	self._input_field_widget = self._widgets_by_name.input_field

	self:_setup_input_labels()

	return
	--- END OF BLOCK #0 ---



end

ConstantElementChat._setup_input_labels = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-15, warpins: 1 ---
	local change_channel_input = self:_get_localized_input_text("cycle_chat_channel")
	local active_placeholder_text = self:_localize("loc_chat_active_placeholder_text", true, {
		input = change_channel_input
	})
	local input_widget = self._input_field_widget
	input_widget.content.active_placeholder_text = active_placeholder_text

	return
	--- END OF BLOCK #0 ---



end

ConstantElementChat._get_localized_input_text = function (self, action)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-18, warpins: 1 ---
	local service_type = DefaultViewInputSettings.service_type
	local alias = Managers.input:alias_object(service_type)
	local alias_array_index = 1
	local device_types = {
		"keyboard"
	}
	local key_info = alias:get_keys_for_alias(action, alias_array_index, device_types)
	local input_key = (key_info and InputUtils.localized_string_from_key_info(key_info)) or "n/a"

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 26-26, warpins: 2 ---
	return input_key
	--- END OF BLOCK #1 ---



end

ConstantElementChat._handle_input = function (self, input_service, ui_renderer)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local input_widget = self._input_field_widget
	local is_input_field_active = input_widget.content.is_writing

	if is_input_field_active then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-11, warpins: 1 ---
		self:_handle_active_chat_input(input_service, ui_renderer)
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-17, warpins: 1 ---
		if input_service:get("send_chat_message") and self._num_connected_channels > 0 then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 22-47, warpins: 1 ---
			input_widget.content.input_text = ""
			input_widget.content.caret_position = 1
			self._selected_channel = self:_next_connected_channel()
			self._activate_input_field = true

			self:_cancel_animations_if_necessary()
			self:_enable_mouse_cursor(true)

			local selected_channel = self._selected_channel

			self:_update_input_field_selected_channel(ui_renderer, input_widget, selected_channel)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 48-48, warpins: 4 ---
	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._handle_active_chat_input = function (self, input_service, ui_renderer)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	local input_widget = self._input_field_widget
	local input_text = input_widget.content.input_text
	local selected_channel = self._selected_channel
	local is_input_field_active = true

	if input_service:get("cycle_chat_channel") then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-15, warpins: 1 ---
		selected_channel = self:_next_connected_channel(selected_channel and selected_channel.priority_index)
		self._selected_channel = selected_channel

		self:_update_input_field_selected_channel(ui_renderer, input_widget, selected_channel)
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 17-26, warpins: 2 ---
		--- END OF BLOCK #1 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 27-32, warpins: 1 ---
		if input_service:get("send_chat_message") then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 33-34, warpins: 1 ---
			if selected_channel and string.len(input_text) > 0 then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 42-54, warpins: 1 ---
				input_text = self:_scrub(input_text)
				local channel_handle = selected_channel.handle

				Managers.chat:send_channel_message(channel_handle, input_text)
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 55-56, warpins: 3 ---
			is_input_field_active = false
			--- END OF BLOCK #1 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 57-62, warpins: 1 ---
			if input_service:get("hotkey_system") then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 63-63, warpins: 1 ---
				is_input_field_active = false
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 64-65, warpins: 4 ---
	if not is_input_field_active then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 66-81, warpins: 1 ---
		self._input_caret_position = nil
		input_widget.content.input_text = ""
		input_widget.content.is_writing = false
		self._activate_input_field = false
		self._selected_channel = nil

		self:_enable_mouse_cursor(false)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 82-82, warpins: 2 ---
	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._update_caret_position = function (self, ui_renderer, input_widget, caret_position, is_caret_visible)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-28, warpins: 1 ---
	local input_widget_style = input_widget.style
	local input_text_style = input_widget_style.text
	local max_text_width = input_text_style.size[1]
	local font_type = input_text_style.font_type
	local font_size = input_text_style.font_size
	local input_text = input_widget.content._input_text
	local display_text, caret_offset, first_pos = self:_crop_text_width(ui_renderer, input_text, font_type, font_size, max_text_width, self._input_text_first_visible_pos, caret_position)
	local input_widget_content = input_widget.content
	input_widget_content.text = display_text
	local input_caret_style = input_widget_style.input_caret
	input_caret_style.offset[1] = input_text_style.offset[1] + caret_offset

	if is_caret_visible ~= nil then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 29-30, warpins: 1 ---
		input_widget_content.input_caret.visible = is_caret_visible
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 31-33, warpins: 2 ---
	self._input_caret_position = caret_position
	self._input_text_first_visible_pos = first_pos

	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._next_connected_channel = function (self, current_priority_index)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	local channel_priorities = ChatSettings.channel_priority
	current_priority_index = current_priority_index or #channel_priorities
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-8, warpins: 2 ---
	local connected_channels = self._connected_channels
	local current_tag, channel_handle = nil
	local first_index = current_priority_index

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 9-9, warpins: 2 ---
	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 9-31, warpins: 0 ---
	repeat

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-9, warpins: 2 ---
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 10-22, warpins: 1 ---
		current_priority_index = math.index_wrapper(current_priority_index + 1, #channel_priorities)
		current_tag = channel_priorities[current_priority_index]
		channel_handle = connected_channels[current_tag]

		if current_tag == ChatManagerConstants.ChannelTag.PARTY and connected_channels[ChatManagerConstants.ChannelTag.MISSION] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 29-29, warpins: 1 ---
			channel_handle = nil
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 30-31, warpins: 3 ---
		--- END OF BLOCK #2 ---



	until channel_handle or current_priority_index == first_index

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 34-35, warpins: 2 ---
	if not channel_handle then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 36-36, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #4 ---

	FLOW; TARGET BLOCK #5



	-- Decompilation error in this vicinity:
	--- BLOCK #5 37-41, warpins: 2 ---
	local next_connected_channel = {}
	next_connected_channel.tag = current_tag
	next_connected_channel.priority_index = current_priority_index
	next_connected_channel.handle = channel_handle

	return next_connected_channel
	--- END OF BLOCK #5 ---



end

ConstantElementChat._update_input_field_selected_channel = function (self, ui_renderer, widget, selected_channel)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-45, warpins: 1 ---
	local channel_tag = selected_channel.tag
	local channel_name = self:_channel_name(channel_tag)
	local selected_channel_text = Managers.localization:localize("loc_chat_to_channel", true, {
		channel_name = channel_name
	})
	widget.content.to_channel = selected_channel_text
	local style = widget.style
	local to_channel_style = style.to_channel
	to_channel_style.text_color = self:_channel_color(channel_tag)
	local field_margin_left = ChatSettings.input_field_margins[1]
	local field_margin_right = ChatSettings.input_field_margins[4]
	local offset = self:_text_size(ui_renderer, selected_channel_text, to_channel_style)
	offset = offset + to_channel_style.offset[1] + field_margin_left
	local text_style = style.display_text
	text_style.offset[1] = offset
	text_style.size = text_style.size or {}
	text_style.size_addition[1] = -(offset + field_margin_right)
	style.active_placeholder.offset[1] = offset
	local is_caret_visible = self._activate_input_field and true

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 47-57, warpins: 2 ---
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 59-59, warpins: 2 ---
	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._update_message_widgets_sizes = function (self, ui_renderer)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local spacing = ChatSettings.message_spacing
	local message_widgets = self._message_widgets
	local i = self._last_message_index
	local widget = message_widgets[i]

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-7, warpins: 2 ---
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 12-31, warpins: 0 ---
	while widget and not widget.content.size do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-12, warpins: 1 ---
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 13-30, warpins: 1 ---
		local widget_size = self:_calculate_widget_size(widget, ui_renderer)
		self._total_chat_height = self._total_chat_height + widget_size[2] + spacing
		i = math.index_wrapper(i - 1, #message_widgets)
		widget = message_widgets[i]
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 31-31, warpins: 1 ---
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 31-31, warpins: 2 ---
	return
	--- END OF BLOCK #3 ---



end

ConstantElementChat._scroll_to_latest_message = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	self._first_visible_chat_message = self._last_message_index
	self._scroll_extra_vertical_offset = 0
	self._has_scrolled_back_in_history = false
	local scrollbar_widget = self._widgets_by_name.chat_scrollbar
	local scrollbar_content = scrollbar_widget.content
	scrollbar_content.scroll_value = nil
	scrollbar_content.value = 1

	return
	--- END OF BLOCK #0 ---



end

ConstantElementChat._update_scrollbar = function (self, render_settings)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-23, warpins: 1 ---
	local messages = self._messages
	local total_num_messages = #messages
	local total_chat_height = self._total_chat_height
	local chat_window_height = self:scenegraph_size("chat_message_area", render_settings.scale)[2]
	local scrollbar_widget = self._widgets_by_name.chat_scrollbar
	local scrollbar_content = scrollbar_widget.content
	local scroll_value = scrollbar_content.scroll_value
	local total_scroll_length = total_chat_height - chat_window_height
	scrollbar_content.scroll_length = total_scroll_length
	scrollbar_content.area_length = chat_window_height
	scrollbar_content.scroll_amount = 1 / (total_num_messages * 3)
	local is_scrollbar_active = scrollbar_content.drag_active

	if self._has_scrolled_back_in_history then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 24-25, warpins: 1 ---
		if (scroll_value and scroll_value == 1) or (not is_scrollbar_active and scrollbar_content.value == 1) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 33-36, warpins: 2 ---
			self:_scroll_to_latest_message()
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 37-39, warpins: 2 ---
			local scroll_length_from_top = self._scroll_length_from_top

			if not is_scrollbar_active then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 40-49, warpins: 1 ---
				scroll_length_from_top = math.max(scroll_length_from_top - self._removed_height_since_last_frame, 0)
				scrollbar_content.value = scroll_length_from_top / total_scroll_length
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 50-51, warpins: 1 ---
				scroll_length_from_top = total_scroll_length * scrollbar_content.value
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 52-58, warpins: 2 ---
			self:_calculate_first_visible_widget(scroll_length_from_top, chat_window_height)

			self._scroll_length_from_top = scroll_length_from_top
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 59-60, warpins: 1 ---
		if is_scrollbar_active or scroll_value then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 63-69, warpins: 2 ---
			self._scroll_length_from_top = total_scroll_length * scrollbar_content.value
			self._total_height_last_frame = total_chat_height
			self._has_scrolled_back_in_history = true
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 70-72, warpins: 1 ---
			self:_scroll_to_latest_message()
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 73-75, warpins: 4 ---
	self._removed_height_since_last_frame = 0

	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._calculate_first_visible_widget = function (self, scroll_length_from_top, chat_window_height)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	local message_widgets = self._message_widgets
	local total_num_messages = #message_widgets
	local message_vertical_offset = self._total_chat_height
	local index = self._last_message_index
	local spacing = ChatSettings.message_spacing
	local window_bottom_position = scroll_length_from_top + chat_window_height

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 12-32, warpins: 0 ---
	for i = 1, total_num_messages, 1 do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-19, warpins: 2 ---
		local widget = message_widgets[index]
		local widget_height = widget.content.size[2]
		message_vertical_offset = message_vertical_offset - (widget_height + spacing)

		if window_bottom_position > message_vertical_offset then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 20-25, warpins: 1 ---
			self._first_visible_chat_message = index
			self._scroll_extra_vertical_offset = (message_vertical_offset + widget_height + spacing) - window_bottom_position

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 26-26, warpins: 1 ---
			break
			--- END OF BLOCK #1 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 26-32, warpins: 1 ---
		index = math.index_wrapper(index - 1, total_num_messages)
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 33-33, warpins: 2 ---
	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._add_notification = function (self, message, channel_tag)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	local widget_definition = self._message_widget_blueprints.notification
	local widget = UIWidget.init(message, widget_definition)
	widget.content.message = message

	if channel_tag then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-18, warpins: 1 ---
		local channel_color = self:_channel_color(channel_tag)
		widget.style.message.text_color = channel_color
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 19-27, warpins: 2 ---
	local messsage_parameters = {}
	messsage_parameters.message_text = message
	messsage_parameters.channel_tag = channel_tag

	self:_add_message_widget_to_message_list(messsage_parameters, widget)

	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._add_message = function (self, message, sender, channel_tag)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local scrubbed_sender = self:_scrub(sender) or ""
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-13, warpins: 2 ---
	local scrubbed_message = self:_scrub(message) or ""
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 15-61, warpins: 2 ---
	local widget_name = scrubbed_sender .. "-" .. scrubbed_message
	local widget_definition = self._message_widget_blueprints.chat_message
	local new_message_widget = UIWidget.init(widget_name, widget_definition)
	local channel_color = self:_channel_color(channel_tag)
	local slug_formatted_color = channel_color[2] .. "," .. channel_color[3] .. "," .. channel_color[4]
	local message_parameters = {}
	message_parameters.proper_channel_color = channel_color
	message_parameters.channel_color = slug_formatted_color
	message_parameters.channel_tag = channel_tag
	message_parameters.author_name = scrubbed_sender
	message_parameters.message_text = scrubbed_message
	local message_format = self:_format_chat_message(message_parameters)
	local widget_content = new_message_widget.content
	widget_content.message_format = message_format
	widget_content.message = message_format
	new_message_widget.alpha_multiplier = self._alpha

	self:_add_message_widget_to_message_list(message_parameters, new_message_widget)

	self._time_since_last_update = 0

	self:_cancel_animations_if_necessary()

	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._scrub = function (self, text)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	if not ChatSettings.scrub_formatting_directives_from_message then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-5, warpins: 1 ---
		return text
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-6, warpins: 2 ---
	local scrubbed_text = nil

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 7-8, warpins: 2 ---
	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 9-20, warpins: 0 ---
	while text ~= scrubbed_text do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-9, warpins: 1 ---
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 10-11, warpins: 1 ---
		text = scrubbed_text or text
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 12-19, warpins: 2 ---
		scrubbed_text = string.gsub(text, "{#.-}", "")
		--- END OF BLOCK #2 ---

		FLOW; TARGET BLOCK #3



		-- Decompilation error in this vicinity:
		--- BLOCK #3 20-20, warpins: 2 ---
		--- END OF BLOCK #3 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 20-27, warpins: 1 ---
	scrubbed_text = string.gsub(scrubbed_text, "{#.-$", "")

	return scrubbed_text
	--- END OF BLOCK #4 ---



end

ConstantElementChat._format_chat_message = function (self, message)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	local message_format = self._message_presentation_format
	local formatted_message = message_format:gsub("%[([a-zA-Z_]+)%]", function (key)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		return message[key]
		--- END OF BLOCK #0 ---



	end)

	return formatted_message
	--- END OF BLOCK #0 ---



end

ConstantElementChat._add_message_widget_to_message_list = function (self, new_message, new_message_widget)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	local messages = self._messages
	local message_widgets = self._message_widgets
	local last_message_index = self._last_message_index
	local message_index = math.index_wrapper(last_message_index + 1, ChatSettings.history_limit)
	local first_visible_message_index = self._first_visible_chat_message

	if message_index <= #self._message_widgets then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 15-19, warpins: 1 ---
		local last_widget_size = message_widgets[message_index].content.size

		if last_widget_size then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 20-29, warpins: 1 ---
			local removed_message_height = last_widget_size[2] + ChatSettings.message_spacing
			self._total_chat_height = self._total_chat_height - removed_message_height
			self._removed_height_since_last_frame = self._removed_height_since_last_frame + removed_message_height
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 30-36, warpins: 3 ---
	messages[message_index] = new_message
	message_widgets[message_index] = new_message_widget
	local input_widget = self._input_field_widget

	if not input_widget.content.is_writing or first_visible_message_index == last_message_index then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 39-41, warpins: 2 ---
		self:_scroll_to_latest_message()
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 42-43, warpins: 2 ---
	self._last_message_index = message_index

	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._calculate_widget_size = function (self, widget, ui_renderer)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-28, warpins: 1 ---
	local widget_content = widget.content
	local widget_style = widget.style
	local message_style = widget_style.message
	local widget_max_size = self:scenegraph_size("chat_message_area")
	local _, message_height, min = self:_text_size(ui_renderer, widget_content.message, message_style, widget_max_size)
	message_style.offset = {
		-min.x,
		-min.y,
		0
	}
	local widget_size = {}
	widget_size[1] = widget_max_size[1]
	widget_size[2] = message_height
	widget_content.size = widget_size

	return widget_size
	--- END OF BLOCK #0 ---



end

ConstantElementChat._enable_mouse_cursor = function (self, is_mouse_cursor_enabled)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if is_mouse_cursor_enabled == self._is_cursor_pushed then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-4, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-9, warpins: 2 ---
	local input_manager = Managers.input
	local name = self.__class_name

	if is_mouse_cursor_enabled then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 10-16, warpins: 1 ---
		input_manager:push_cursor(name)

		self._is_cursor_pushed = true
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 17-22, warpins: 1 ---
		input_manager:pop_cursor(name)

		self._is_cursor_pushed = false
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 23-23, warpins: 2 ---
	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._on_connect_to_channel = function (self, channel_handle)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	local channel = self._channels[channel_handle]
	local channel_tag = channel.tag
	local connected_channels = self._connected_channels

	if not connected_channels[channel_tag] then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-16, warpins: 1 ---
		connected_channels[channel_tag] = channel_handle
		self._num_connected_channels = self._num_connected_channels + 1
		local channel_tags = ChatManagerConstants.ChannelTag
		local is_redunant = (channel_tag == channel_tags.PARTY and connected_channels[channel_tags.MISSION]) or (channel_tag == channel_tags.MISSION and connected_channels[channel_tags.PARTY])

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 30-31, warpins: 4 ---
		if not is_redunant then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 32-49, warpins: 1 ---
			local channel_name = self:_channel_name(channel_tag, true)
			local add_channel_message = Managers.localization:localize("loc_chat_joined_channel", true, {
				channel_name = channel_name
			})

			self:_add_notification(add_channel_message)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 50-50, warpins: 3 ---
	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._on_disconnect_from_channel = function (self, channel_handle)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local connected_channels = self._connected_channels

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-50, warpins: 0 ---
	for channel_tag, connected_channel_handle in pairs(connected_channels) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-7, warpins: 1 ---
		if connected_channel_handle == channel_handle then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 8-17, warpins: 1 ---
			connected_channels[channel_tag] = nil
			self._num_connected_channels = self._num_connected_channels - 1
			local channel_tags = ChatManagerConstants.ChannelTag
			local is_redunant = (channel_tag == channel_tags.PARTY and connected_channels[channel_tags.MISSION]) or (channel_tag == channel_tags.MISSION and connected_channels[channel_tags.PARTY])
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 31-48, warpins: 4 ---
			local channel_name = self:_channel_name(channel_tag, true)
			local remove_channel_message = Managers.localization:localize("loc_chat_left_channel", true, {
				channel_name = channel_name
			})

			self:_add_notification(remove_channel_message)
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 49-50, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 51-51, warpins: 1 ---
	return
	--- END OF BLOCK #2 ---



end

ConstantElementChat._channel_name = function (self, channel_tag, colorize)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local channel_metadata = ChatSettings.channel_metadata[channel_tag]
	local channel_loc_key = channel_metadata and channel_metadata.name

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 7-8, warpins: 2 ---
	if not channel_loc_key then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-9, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 10-17, warpins: 2 ---
	local channel_name = Managers.localization:localize(channel_loc_key)

	if colorize then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 18-32, warpins: 1 ---
		local color = channel_metadata.color
		local formatted_color = color[2] .. "," .. color[3] .. "," .. color[4] .. "," .. color[1]
		channel_name = "{# color(" .. formatted_color .. ")}" .. channel_name .. "{#reset()}"
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 33-33, warpins: 2 ---
	return channel_name
	--- END OF BLOCK #3 ---



end

ConstantElementChat._channel_color = function (self, channel_tag)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local channel_metadata = ChatSettings.channel_metadata[channel_tag]

	if not channel_metadata then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-7, warpins: 1 ---
		return {
			255,
			255,
			0,
			255
		}
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-9, warpins: 2 ---
	return channel_metadata.color
	--- END OF BLOCK #1 ---



end

ConstantElementChat._text_size = function (self, ui_renderer, text, font_style, max_width)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	local scale = ui_renderer.scale or 1
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-22, warpins: 2 ---
	local scaled_font_size = UIFonts.scaled_size(font_style.font_size, scale)
	local sender_font_options = UIFonts.get_font_options_by_style(font_style)

	return UIRenderer.text_size(ui_renderer, text, font_style.font_type, scaled_font_size, max_width, sender_font_options)
	--- END OF BLOCK #1 ---



end

ConstantElementChat._cancel_animations_if_necessary = function (self, force_cancellation)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	if self._active_state == STATE_HIDDEN or force_cancellation then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-12, warpins: 2 ---
		if self:_is_animation_active(self._chat_window_animation_id) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-16, warpins: 1 ---
			self:_complete_animation(self._chat_window_animation_id)
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 17-22, warpins: 2 ---
		if self:_is_animation_active(self._input_field_animation_id) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 23-26, warpins: 1 ---
			self:_complete_animation(self._input_field_animation_id)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 27-27, warpins: 3 ---
	return
	--- END OF BLOCK #1 ---



end

ConstantElementChat._apply_visibility_parameters = function (self, optional_visibility_parameters)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	if not optional_visibility_parameters then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 3-4, warpins: 1 ---
		return false
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-13, warpins: 2 ---
	local horizontal_alignment = optional_visibility_parameters.horizontal_alignment
	local vertical_alignment = optional_visibility_parameters.vertical_alignment
	local chat_window_offset = optional_visibility_parameters.chat_window_offset
	local chat_window_size = optional_visibility_parameters.chat_window_size
	local chat_window = self._ui_scenegraph.chat_window
	local need_to_update_scenegraph = false

	if horizontal_alignment and horizontal_alignment ~= chat_window.horizontal_alignment then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 17-18, warpins: 1 ---
		chat_window.horizontal_alignment = horizontal_alignment
		need_to_update_scenegraph = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 19-20, warpins: 3 ---
	if vertical_alignment and vertical_alignment ~= chat_window.vertical_alignment then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 24-25, warpins: 1 ---
		chat_window.vertical_alignment = vertical_alignment
		need_to_update_scenegraph = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 26-27, warpins: 3 ---
	if chat_window_offset then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 28-30, warpins: 1 ---
		if chat_window_offset[1] and chat_window_offset[1] ~= chat_window.position[1] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 36-39, warpins: 1 ---
			chat_window.position[1] = chat_window_offset[1]
			need_to_update_scenegraph = true
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 40-42, warpins: 3 ---
		if chat_window_offset[2] and chat_window_offset[2] ~= chat_window.position[2] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 48-51, warpins: 1 ---
			chat_window.position[2] = chat_window_offset[2]
			need_to_update_scenegraph = true
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 52-54, warpins: 3 ---
		if chat_window_offset[3] and chat_window_offset[3] ~= chat_window.position[3] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 60-63, warpins: 1 ---
			chat_window.position[3] = chat_window_offset[3]
			need_to_update_scenegraph = true
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 64-65, warpins: 4 ---
	if chat_window_size then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 66-68, warpins: 1 ---
		if chat_window_size[1] and chat_window_size[1] ~= chat_window.size[1] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 74-77, warpins: 1 ---
			chat_window.size[1] = chat_window_size[1]
			need_to_update_scenegraph = true
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 78-80, warpins: 3 ---
		if chat_window_size[2] and chat_window_size[2] ~= chat_window.size[2] then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 86-89, warpins: 1 ---
			chat_window.size[2] = chat_window_size[2]
			need_to_update_scenegraph = true
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #4 ---

	FLOW; TARGET BLOCK #5



	-- Decompilation error in this vicinity:
	--- BLOCK #5 90-90, warpins: 4 ---
	return need_to_update_scenegraph
	--- END OF BLOCK #5 ---



end

return ConstantElementChat
