-- Decompilation Error: _run_step(_unwarp_expressions, node)

-- Decompilation Error: _glue_flows(node)

-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
local PartyImmateriumMember = require("scripts/managers/party_immaterium/party_immaterium_member")
local PartyImmateriumConnection = require("scripts/managers/party_immaterium/party_immaterium_connection")
local PartyImmateriumMemberMyself = require("scripts/managers/party_immaterium/party_immaterium_member_myself")
local LocalizedErrorCodes = require("scripts/managers/party_immaterium/party_immaterium_localized_error_codes")
local CommonJoinPermission = require("scripts/managers/party_immaterium/join_permission/common_join_permission")
local XboxJoinPermission = require("scripts/managers/party_immaterium/join_permission/xbox_join_permission")
local SteamJoinPermission = require("scripts/managers/party_immaterium/join_permission/steam_join_permission")
local PlayerCompositions = require("scripts/utilities/players/player_compositions")
local PartyConstants = require("scripts/settings/network/party_constants")
local Promise = require("scripts/foundation/utilities/promise")
local PartyImmateriumManager = class("PartyImmateriumManager")

local function _info(...)
	Log.info("PartyImmateriumManager", ...)
end

local function _error(...)
	Log.error("PartyImmateriumManager", ...)
end

local function _warn(...)
	Log.warning("PartyImmateriumManager", ...)
end

PartyImmateriumManager.init = function (self)
	self._myself = PartyImmateriumMemberMyself:new()
	self._cached_debug_get_parties = {}
	self._cached_debug_get_parties_time = 0
	self._last_party_connection_retry = 0
	self._last_party_connection_wait_done = false
	self._party_error_count = 0
	self._started = false
	self._last_join_permission_ensure = 0
	self._party_connection = nil
	self._joining_party_connection = nil
	self._game_session_promises = {}
	self._invite_popups = {}
	self._request_to_join_popups = {}

	self:_reset_party_data()
	Managers.event:register(self, "party_immaterium_request_to_join", "_handle_request_to_join")
	Managers.event:register(self, "party_immaterium_request_to_join_popup_cancel", "_handle_request_to_join_popup_cancel")
	Managers.event:register(self, "party_immaterium_member_joined", "_handle_member_joined")
	Managers.event:register(self, "party_immaterium_member_left", "_handle_member_left")
	Managers.event:register(self, "party_immaterium_member_kicked", "_handle_member_kicked")
	Managers.event:register(self, "party_immaterium_member_disconnected", "_handle_member_disconnected")
	Managers.event:register(self, "party_immaterium_invite_created", "_handle_invite_created")
	Managers.event:register(self, "party_immaterium_invite_timeout", "_handle_invite_timeout")
	Managers.event:register(self, "party_immaterium_invite_canceled", "_handle_invite_canceled")
	Managers.event:register(self, "party_immaterium_invite_accepted", "_handle_invite_accepted")
	Managers.event:register(self, "backend_party_invite", "_handle_immaterium_invite")
	Managers.event:register(self, "backend_party_invite_canceled", "_handle_immaterium_invite_canceled")
	Managers.event:register(self, "backend_party_invite_timeout", "_handle_immaterium_invite_timeout")
	Managers.event:register(self, "event_stay_in_party_voting_started", "_handle_stay_in_party_voting_started")
	Managers.event:register(self, "event_stay_in_party_voting_completed", "_handle_stay_in_party_voting_completed")
	Managers.event:register(self, "event_stay_in_party_voting_aborted", "_handle_stay_in_party_voting_aborted")
end

PartyImmateriumManager.destroy = function (self)
	Managers.event:unregister(self, "party_immaterium_request_to_join")
	Managers.event:unregister(self, "party_immaterium_request_to_join_popup_cancel")
	Managers.event:unregister(self, "party_immaterium_member_joined")
	Managers.event:unregister(self, "party_immaterium_member_left")
	Managers.event:unregister(self, "party_immaterium_member_kicked")
	Managers.event:unregister(self, "party_immaterium_member_disconnected")
	Managers.event:unregister(self, "party_immaterium_invite_created")
	Managers.event:unregister(self, "party_immaterium_invite_timeout")
	Managers.event:unregister(self, "party_immaterium_invite_canceled")
	Managers.event:unregister(self, "party_immaterium_invite_accepted")
	Managers.event:unregister(self, "backend_party_invite")
	Managers.event:unregister(self, "backend_party_invite_canceled")
	Managers.event:unregister(self, "backend_party_invite_timeout")
	Managers.event:unregister(self, "event_stay_in_party_voting_started")
	Managers.event:unregister(self, "event_stay_in_party_voting_completed")
	Managers.event:unregister(self, "event_stay_in_party_voting_aborted")
end

PartyImmateriumManager._resolve_join_permission = function (self, presence_entry, context_suffix)
	if not context_suffix then
		context_suffix = ""
	else
		context_suffix = "_" .. context_suffix
	end

	if not presence_entry:is_online() then
		return Promise.resolved(nil)
	end

	local promises = {}

	table.insert(promises, CommonJoinPermission.test_play_mutliplayer_permission(presence_entry:account_id(), presence_entry:platform(), presence_entry:platform_user_id(), context_suffix))

	local authenticate_method = Managers.backend:get_auth_method()

	if authenticate_method == Managers.backend.AUTH_METHOD_XBOXLIVE then
		table.insert(promises, XboxJoinPermission.test_play_mutliplayer_permission(presence_entry:account_id(), presence_entry:platform(), presence_entry:platform_user_id(), context_suffix))
	elseif authenticate_method == Managers.backend.AUTH_METHOD_STEAM then
		table.insert(promises, SteamJoinPermission.test_play_mutliplayer_permission(presence_entry:account_id(), presence_entry:platform(), presence_entry:platform_user_id(), context_suffix))
	end

	if #promises == 0 then
		return Promise.resolved(nil)
	end

	return Promise.all(unpack(promises)):catch(function (results)
		for _, result in ipairs(results) do
			if result ~= "OK" then
				return Promise.rejected({
					error_details = result
				})
			end
		end
	end)
end

PartyImmateriumManager._ensure_join_permission_on_current_party = function (self, dt)
	self._last_join_permission_ensure = self._last_join_permission_ensure + dt

	if self._last_join_permission_ensure > 1 then
		for _, member in ipairs(self._other_members) do
			local presence = member:presence()

			if presence:is_online() and not presence:is_myself() then
				local id = presence:account_and_platform_composite_id()

				if not self._resolved_join_permissions[id] then
					self:_resolve_join_permission(presence):catch(function (error)
						_warn("Leaving party since I don't like %s, code=%s", table.tostring(presence, 5), error.error_details)

						self._resolved_join_permissions[id] = false

						self:leave_party()
					end)

					self._resolved_join_permissions[id] = true
				end
			end
		end

		self._last_join_permission_ensure = 0
	end
end

PartyImmateriumManager._resolve_join_permission_on_whole_party = function (self, party)
	local presence_promises = {}
	local my_account_id = self._myself:account_id()

	for _, member in ipairs(party.members) do
		if my_account_id ~= member.account_id then
			local _, presence_promise = Managers.presence:get_presence(member.account_id)
			local promise = presence_promise:catch(function (error)
				_warn("could not get presence for %s, error=%s, letting it pass as fallback", member.account_id, table.tostring(error))

				return Promise.resolved(nil)
			end):next(function (presence_entry)
				if presence_entry then
					return self:_resolve_join_permission(presence_entry)
				end

				return Promise.resolved(nil)
			end)

			table.insert(presence_promises, promise)
		end
	end

	return Promise.all(unpack(presence_promises)):catch(function (packed_results)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-4, warpins: 1 ---
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 5-15, warpins: 0 ---
		for _, result in ipairs(packed_results) do

			-- Decompilation error in this vicinity:
			--- BLOCK #0 5-6, warpins: 1 ---
			if result and result.error_details then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 10-13, warpins: 1 ---
				return Promise.rejected(result)
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 14-15, warpins: 4 ---
			--- END OF BLOCK #1 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 16-16, warpins: 1 ---
		return
		--- END OF BLOCK #2 ---



	end)
end

PartyImmateriumManager.start = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if self._started then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-6, warpins: 1 ---
		self:reset()
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 7-19, warpins: 2 ---
	self._started = true
	local default_party_id = ""

	return self:join_party(default_party_id, true):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-14, warpins: 1 ---
		Log.error("could not join default party, trying an empty party instead.. error=" .. table.tostring(error, 5))

		return self:leave_party()
		--- END OF BLOCK #0 ---



	end)
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.reset = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	self:_reset_party_data()

	if self._joining_party_connection then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-12, warpins: 1 ---
		self._joining_party_connection:abort()

		self._joining_party_connection = nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 13-15, warpins: 2 ---
	if self._party_connection then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 16-21, warpins: 1 ---
		self._party_connection:abort()

		self._party_connection = nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 22-24, warpins: 2 ---
	self._started = false

	return
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._reset_party_data = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	self._other_members = {}
	self._resolved_join_permissions = {}
	self._triggered_game_state_status = ""
	self._last_state = PartyConstants.State.none

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 15-20, warpins: 0 ---
	for joiner_account_id, _ in pairs(self._request_to_join_popups) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 15-18, warpins: 1 ---
		self:_close_request_to_join_popup(joiner_account_id)
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 19-20, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 21-28, warpins: 1 ---
	table.clear(self._request_to_join_popups)

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 29-34, warpins: 0 ---
	for _, game_session_promise in ipairs(self._game_session_promises) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 29-32, warpins: 1 ---
		game_session_promise:reject({
			error_details = "PARTY_RESET"
		})
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 33-34, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 35-39, warpins: 1 ---
	table.clear(self._game_session_promises)

	return
	--- END OF BLOCK #4 ---



end

PartyImmateriumManager.other_members = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	return self._other_members
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.member_from_account_id = function (self, account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:unique_id() == account_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-8, warpins: 1 ---
		return self._myself
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 9-12, warpins: 2 ---
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 13-20, warpins: 0 ---
	for _, member in ipairs(self._other_members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-17, warpins: 1 ---
		if member:unique_id() == account_id then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 18-18, warpins: 1 ---
			return member
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 19-20, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 21-22, warpins: 1 ---
	return false
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager.member_from_peer_id = function (self, peer_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:peer_id() == peer_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-8, warpins: 1 ---
		return self._myself
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 9-12, warpins: 2 ---
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 13-20, warpins: 0 ---
	for _, member in ipairs(self._other_members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-17, warpins: 1 ---
		if member:peer_id() == peer_id then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 18-18, warpins: 1 ---
			return member
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 19-20, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 21-22, warpins: 1 ---
	return false
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager.other_member_from_unique_id = function (self, unique_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-12, warpins: 0 ---
	for _, member in ipairs(self._other_members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-9, warpins: 1 ---
		if member:unique_id() == unique_id then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 10-10, warpins: 1 ---
			return member
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 11-12, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 13-14, warpins: 1 ---
	return false
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._generate_compabillity_string = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	return Managers.connection.combined_hash
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.debug_get_parties = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if BUILD == "release" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-5, warpins: 1 ---
		return {}
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-13, warpins: 2 ---
	return Managers.grpc:debug_get_parties(self:_generate_compabillity_string())
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.cached_debug_get_parties = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	return self._cached_debug_get_parties
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._fetch_cached_debug_get_parties = function (self, dt, force)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if BUILD == "release" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-4, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-11, warpins: 1 ---
	self._cached_debug_get_parties_time = self._cached_debug_get_parties_time + dt

	if self._cached_debug_get_parties_time > 10 or force then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 14-26, warpins: 2 ---
		self:debug_get_parties():next(function (result)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-4, warpins: 1 ---
			self._cached_debug_get_parties = result.parties

			return
			--- END OF BLOCK #0 ---



		end):catch(function (error)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-11, warpins: 1 ---
			Log.error("[PartyImmateriumManager] Could not fetch debug get parties " .. self:_table_tostring_or_string(error))

			return
			--- END OF BLOCK #0 ---



		end)

		self._cached_debug_get_parties_time = 0
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 27-28, warpins: 2 ---
	return
	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 29-29, warpins: 2 ---
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager.leave_party = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-13, warpins: 1 ---
	local leaving_party_connection = self._party_connection
	self._party_connection = nil
	local default_party_id = ""
	slot4 = Managers.grpc
	slot3 = Managers.grpc.leave_party
	slot5 = self:party_id() or ""

	return slot3(Managers.grpc, slot5):next(function ()

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if leaving_party_connection then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 4-7, warpins: 1 ---
			leaving_party_connection:abort()
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 8-12, warpins: 2 ---
		return self:join_party(default_party_id)
		--- END OF BLOCK #1 ---



	end):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if leaving_party_connection then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 4-7, warpins: 1 ---
			leaving_party_connection:abort()
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 8-23, warpins: 2 ---
		Log.error("PartyImmateriumManager", "failed to leave party " .. table.tostring(error, 3))

		return self:join_party(default_party_id)
		--- END OF BLOCK #1 ---



	end)

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #1 14-14, warpins: 1 ---
	slot5 = ""
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 15-24, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager.join_party = function (self, party_id, is_reconnect)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	local party_connection, accept_party_promise = nil

	if party_id == "" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-5, warpins: 1 ---
		slot5 = false
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-6, warpins: 1 ---
		local is_party_id = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 7-8, warpins: 2 ---
	if is_party_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-20, warpins: 1 ---
		accept_party_promise = Managers.grpc:get_party(party_id):next(function (party)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-5, warpins: 1 ---
			return self:_resolve_join_permission_on_whole_party(party)
			--- END OF BLOCK #0 ---



		end)
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 21-24, warpins: 1 ---
		accept_party_promise = Promise.resolved()
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 25-37, warpins: 2 ---
	return accept_party_promise:next(function ()

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-4, warpins: 1 ---
		if self._joining_party_connection then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 5-9, warpins: 1 ---
			self._joining_party_connection:abort()
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 10-32, warpins: 2 ---
		party_connection = PartyImmateriumConnection:new(party_id, self:_generate_compabillity_string(), function (session_id)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-5, warpins: 1 ---
			return self:_hot_join_ticket(session_id)
			--- END OF BLOCK #0 ---



		end)
		self._joining_party_connection = party_connection

		party_connection:start()

		return party_connection:join_promise()
		--- END OF BLOCK #1 ---



	end):next(function ()

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-5, warpins: 1 ---
		if party_connection == self._joining_party_connection then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 6-8, warpins: 1 ---
			self._joining_party_connection = nil
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 9-12, warpins: 2 ---
		if self._party_connection then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-17, warpins: 1 ---
			self._party_connection:abort()
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 18-30, warpins: 2 ---
		self._party_connection = party_connection

		self:_reset_party_data()

		slot1 = self
		slot0 = self._on_join_party

		if is_reconnect then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 31-38, warpins: 1 ---
			if party_connection:party().version <= 1 then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 39-40, warpins: 1 ---
				slot2 = false
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 41-41, warpins: 1 ---
				slot2 = true
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #2 ---

		FLOW; TARGET BLOCK #3



		-- Decompilation error in this vicinity:
		--- BLOCK #3 42-43, warpins: 3 ---
		slot0(slot1, slot2)

		return
		--- END OF BLOCK #3 ---



	end):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if party_connection and party_connection == self._joining_party_connection then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 9-11, warpins: 1 ---
			self._joining_party_connection = nil
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 12-14, warpins: 3 ---
		if not error.aborted then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 15-19, warpins: 1 ---
			self:_on_join_party_error(error.error_details)
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 20-32, warpins: 2 ---
		_error("could not join party " .. table.tostring(error, 5))

		return Promise.rejected(error)
		--- END OF BLOCK #2 ---



	end)
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._hot_join_ticket = function (self, mission_session_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	_info("Getting ticket for mission_session_id=" .. mission_session_id)

	local profile = Managers.player:local_player_backend_profile()

	if profile then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-13, warpins: 1 ---
		local character_id = profile.character_id
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 14-15, warpins: 2 ---
	if not character_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 16-19, warpins: 1 ---
		return Promise.rejected({
			error_details = "NO_CHARACTER_SELECTED"
		})
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 20-33, warpins: 1 ---
	return Managers.backend.interfaces.matchmaker:fetch_queue_ticket_mission_hotjoin(mission_session_id, character_id):next(function (response)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-2, warpins: 1 ---
		return response.ticket
		--- END OF BLOCK #0 ---



	end)
	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 34-34, warpins: 2 ---
	--- END OF BLOCK #3 ---



end

local empty_object = {}

PartyImmateriumManager.party_id = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not self._party_connection or not self._party_connection:party().party_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-11, warpins: 2 ---
		slot1 = ""
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 12-12, warpins: 2 ---
	return slot1
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._party_version = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not self._party_connection or not self._party_connection:party().version then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-11, warpins: 2 ---
		slot1 = 0
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 12-12, warpins: 2 ---
	return slot1
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.party_vote_state = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not self._party_connection or not self._party_connection:party_vote() then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 10-10, warpins: 2 ---
		slot1 = empty_object
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 11-11, warpins: 2 ---
	return slot1
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.party_game_state = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not self._party_connection or not self._party_connection:party_game_state() then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 10-10, warpins: 2 ---
		slot1 = empty_object
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 11-11, warpins: 2 ---
	return slot1
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.broadcast = function (self, type, payload)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-13, warpins: 1 ---
	return Managers.grpc:party_broadcast(self:party_id(), self:_party_version(), type, payload)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.start_vote = function (self, type, params, myParams)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	return Managers.grpc:start_party_vote(self:party_id(), self:_party_version(), type, params, myParams)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.answer_vote = function (self, vote_id, yes, myParams)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	return Managers.grpc:answer_party_vote(vote_id, self:party_id(), yes, myParams)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_party_event = function (self, event)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if event.event_type == "party_update" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-8, warpins: 1 ---
		self:_handle_party_update_event(event)
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-11, warpins: 1 ---
		if event.event_type == "party_game_state_update" then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 12-16, warpins: 1 ---
			self:_handle_party_game_state_update_event(event)
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 17-19, warpins: 1 ---
			if event.event_type == "party_client_event_trigger" then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 20-23, warpins: 1 ---
				self:_handle_party_client_event_trigger(event)
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 24-24, warpins: 4 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._handle_party_update_event = function (self, event)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local members = event.members
	local new_other_member_list = {}

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 7-35, warpins: 0 ---
	for _, immaterium_entry in ipairs(members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-12, warpins: 1 ---
		local account_id = immaterium_entry.account_id

		if account_id ~= gRPC.get_account_id() then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-18, warpins: 1 ---
			local member = self:other_member_from_unique_id(account_id)

			if not member then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 19-24, warpins: 1 ---
				member = PartyImmateriumMember:new(account_id)
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 25-33, warpins: 2 ---
			member:update_immaterium_entry(immaterium_entry)
			table.insert(new_other_member_list, member)
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 34-35, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 36-47, warpins: 1 ---
	self._other_members = new_other_member_list

	Managers.presence:set_party(event.party_id, #members)

	if #members >= 4 then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 48-51, warpins: 1 ---
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 52-68, warpins: 0 ---
		for joiner_account_id, _ in pairs(self._request_to_join_popups) do

			-- Decompilation error in this vicinity:
			--- BLOCK #0 52-66, warpins: 1 ---
			local party_id = self:party_id()

			Managers.grpc:answer_request_to_join(party_id, joiner_account_id, "PARTY_FULL")
			self:_close_request_to_join_popup(joiner_account_id)
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 67-68, warpins: 2 ---
			--- END OF BLOCK #1 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 69-72, warpins: 1 ---
		table.clear(self._request_to_join_popups)
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 73-77, warpins: 2 ---
	PlayerCompositions.trigger_change_event("party")

	return
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager._handle_party_game_state_update_event = function (self, event)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	self:_execute_triggers_for_game_state()

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_party_client_event_trigger = function (self, event)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	Managers.event:trigger("party_immaterium_" .. event.trigger_event_name, unpack(event.args))

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_request_to_join = function (self, joiner_account_id, popup)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:account_id() == joiner_account_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-7, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-22, warpins: 1 ---
	local _, inviteePresencePromise = Managers.presence:get_presence(joiner_account_id)
	local party_id = self:party_id()

	inviteePresencePromise:next(function (requester_presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if popup then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 4-12, warpins: 1 ---
			if self:current_state() == PartyConstants.State.in_mission or self:current_state() == PartyConstants.State.matchmaking_acceptance_vote then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 22-30, warpins: 2 ---
				Managers.grpc:answer_request_to_join(party_id, joiner_account_id, "OK_POPUP")
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 31-36, warpins: 1 ---
				self:_request_to_join_popup(joiner_account_id)
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 37-50, warpins: 1 ---
			self:_resolve_join_permission(requester_presence, "JOIN_REQUEST"):next(function ()

				-- Decompilation error in this vicinity:
				--- BLOCK #0 1-9, warpins: 1 ---
				Managers.grpc:answer_request_to_join(party_id, joiner_account_id, "OK")

				return
				--- END OF BLOCK #0 ---



			end):catch(function (error)

				-- Decompilation error in this vicinity:
				--- BLOCK #0 1-9, warpins: 1 ---
				Managers.grpc:answer_request_to_join(party_id, joiner_account_id, error.error_details)

				return
				--- END OF BLOCK #0 ---



			end)
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 51-51, warpins: 3 ---
		return
		--- END OF BLOCK #1 ---



	end)

	return
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 23-23, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._check_for_invites = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	local social_service = Managers.data_service.social

	if social_service:has_invite() then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-19, warpins: 1 ---
		local invite_address = social_service:get_invite()

		_info("Joining party %s through invite", invite_address)
		self:join_party(invite_address)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 20-20, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.update = function (self, dt, t)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if not self._started then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-4, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-10, warpins: 2 ---
	local current_state = self:current_state()

	if self._last_state ~= current_state then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-18, warpins: 1 ---
		_info("State changed from " .. self._last_state .. " to " .. current_state)

		self._last_state = current_state
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 19-35, warpins: 2 ---
	self:_ensure_join_permission_on_current_party(dt)
	self:_matchmaking_status_notifier()
	self:_check_for_invites()

	self._last_party_connection_retry = self._last_party_connection_retry + dt

	if self._last_party_connection_retry > 10 then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 36-39, warpins: 1 ---
		local party_connection = self._party_connection

		if not self._last_party_connection_wait_done then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 40-42, warpins: 1 ---
			self._last_party_connection_wait_done = true
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 43-44, warpins: 1 ---
			if party_connection and party_connection:error() then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 50-67, warpins: 1 ---
				_error("party connection failed with error " .. table.tostring(self._party_connection:error(), 5))

				self._last_party_connection_wait_done = false

				self:leave_party()
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 68-69, warpins: 2 ---
				if not party_connection then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 70-77, warpins: 1 ---
					_error("party_connection is missing")

					self._last_party_connection_wait_done = false

					self:leave_party()
					--- END OF BLOCK #0 ---



				end
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 78-79, warpins: 4 ---
		self._last_party_connection_retry = 0
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 80-89, warpins: 2 ---
	self._myself:update_account_id(gRPC.get_account_id())

	if self._joining_party_connection then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 90-94, warpins: 1 ---
		self._joining_party_connection:update(dt)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 95-97, warpins: 2 ---
	if self._party_connection then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 98-110, warpins: 1 ---
		self._party_connection:update(dt)

		local event_buffer = self._party_connection:event_buffer()

		if #event_buffer > 0 then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 111-114, warpins: 1 ---
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 115-129, warpins: 0 ---
			for i, event in ipairs(event_buffer) do

				-- Decompilation error in this vicinity:
				--- BLOCK #0 115-127, warpins: 1 ---
				_info("recevied party event " .. table.tostring(event, 3))
				self:_handle_party_event(event)
				--- END OF BLOCK #0 ---

				FLOW; TARGET BLOCK #1



				-- Decompilation error in this vicinity:
				--- BLOCK #1 128-129, warpins: 2 ---
				--- END OF BLOCK #1 ---



			end

			--- END OF BLOCK #1 ---

			FLOW; TARGET BLOCK #2



			-- Decompilation error in this vicinity:
			--- BLOCK #2 130-133, warpins: 1 ---
			self._party_connection:reset_event_buffer()
			--- END OF BLOCK #2 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #4 ---

	FLOW; TARGET BLOCK #5



	-- Decompilation error in this vicinity:
	--- BLOCK #5 134-134, warpins: 3 ---
	return
	--- END OF BLOCK #5 ---



end

PartyImmateriumManager.is_in_matchmaking = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	if self:current_state() ~= PartyConstants.State.matchmaking then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-10, warpins: 1 ---
		slot1 = false
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-11, warpins: 1 ---
		slot1 = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 12-12, warpins: 2 ---
	return slot1
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._matchmaking_status_notifier = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local is_in_matchmaking = self:is_in_matchmaking()

	if is_in_matchmaking and not self._is_in_matchmaking_message_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-18, warpins: 1 ---
		Managers.event:trigger("event_add_notification_message", "mission", "Party is in matchmaking, please wait...", function (id)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-3, warpins: 1 ---
			self._is_in_matchmaking_message_id = id

			return
			--- END OF BLOCK #0 ---



		end)
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 19-20, warpins: 2 ---
		if not is_in_matchmaking and self._is_in_matchmaking_message_id then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 24-32, warpins: 1 ---
			Managers.event:trigger("event_remove_notification", self._is_in_matchmaking_message_id)

			self._is_in_matchmaking_message_id = nil
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 33-34, warpins: 4 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._reject_game_session_promises = function (self, error)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-10, warpins: 0 ---
	for _, game_session_promise in ipairs(self._game_session_promises) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-8, warpins: 1 ---
		game_session_promise:reject(error)
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 9-10, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 11-15, warpins: 1 ---
	table.clear(self._game_session_promises)

	return
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._resolve_game_session_promises = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 5-10, warpins: 0 ---
	for _, game_session_promise in ipairs(self._game_session_promises) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-8, warpins: 1 ---
		game_session_promise:resolve(self)
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 9-10, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 11-15, warpins: 1 ---
	table.clear(self._game_session_promises)

	return
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._execute_triggers_for_game_state = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	local game_state = self:party_game_state()
	local game_state_status = game_state.status

	if self._triggered_game_state_status ~= game_state_status then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-9, warpins: 1 ---
		if game_state_status == "" and self._triggered_game_state_status == "MATCHMAKING_IN_PROGRESS" then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-16, warpins: 1 ---
			if game_state.matchmaking.matchmaking_status == "CANCELLED" then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 17-25, warpins: 1 ---
				self:_mission_matchmaking_aborted("CANCELLED")
				self:_reject_game_session_promises({
					error_details = "MATCHMAKING_CANCELLED"
				})
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 26-38, warpins: 1 ---
				self:_mission_matchmaking_aborted(game_state.matchmaking.failed_message)
				self:_reject_game_session_promises({
					error_details = game_state.matchmaking.failed_message
				})
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 39-40, warpins: 2 ---
			if game_state_status == "" then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 41-45, warpins: 1 ---
				self:_reject_game_session_promises({
					error_details = "UNDEFINED_ERROR"
				})
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 46-47, warpins: 1 ---
				if game_state_status == "GAME_SESSION_IN_PROGRESS" then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 48-50, warpins: 1 ---
					self:_resolve_game_session_promises()
					--- END OF BLOCK #0 ---



				end
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 51-51, warpins: 5 ---
		self._triggered_game_state_status = game_state_status
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 52-52, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.current_state = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local game_state = self:party_game_state()

	if game_state.status == "MATCHMAKING_IN_PROGRESS" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-10, warpins: 1 ---
		return PartyConstants.State.matchmaking
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 11-13, warpins: 2 ---
	if game_state.status == "GAME_SESSION_IN_PROGRESS" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 14-17, warpins: 1 ---
		return PartyConstants.State.in_mission
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 18-20, warpins: 2 ---
	if game_state.status == "ACCEPTANCE_VOTE_IN_PROGRESS" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 21-24, warpins: 1 ---
		return PartyConstants.State.matchmaking_acceptance_vote
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 25-30, warpins: 2 ---
	local party_vote_state = self:party_vote_state()

	if party_vote_state.type == "accept_matchmaking" and party_vote_state.state == "ONGOING" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 34-37, warpins: 1 ---
		return PartyConstants.State.matchmaking_acceptance_vote
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 38-41, warpins: 3 ---
	return PartyConstants.State.none
	--- END OF BLOCK #4 ---



end

PartyImmateriumManager.are_all_members_in_hub = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	if self:get_myself():presence_name() ~= "hub" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-10, warpins: 1 ---
		return false
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 11-14, warpins: 2 ---
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 15-23, warpins: 0 ---
	for _, member in ipairs(self._other_members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 15-19, warpins: 1 ---
		if member:presence_name() ~= "hub" then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 20-21, warpins: 1 ---
			return false
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 22-23, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 24-25, warpins: 1 ---
	return true
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager.are_all_members_in_mission = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	local my_presence = self:get_myself():presence_name()

	if my_presence ~= "mission" and my_presence ~= "end_of_round" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-12, warpins: 1 ---
		slot2 = false
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-13, warpins: 2 ---
		local in_mission = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 14-15, warpins: 2 ---
	if not in_mission then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 16-17, warpins: 1 ---
		return false
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 18-21, warpins: 2 ---
	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 22-37, warpins: 0 ---
	for _, member in ipairs(self._other_members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 22-26, warpins: 1 ---
		local member_presence = member:presence_name()

		if member_presence ~= "mission" and member_presence ~= "end_of_round" then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 29-30, warpins: 1 ---
			slot9 = false
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 31-31, warpins: 2 ---
			local member_in_mission = true
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 32-33, warpins: 2 ---
		if not member_in_mission then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 34-35, warpins: 1 ---
			return false
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 36-37, warpins: 3 ---
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 38-39, warpins: 1 ---
	return true
	--- END OF BLOCK #4 ---



end

PartyImmateriumManager.num_party_members_in_mission = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-9, warpins: 1 ---
	local num_party_members_in_mission = 0
	local my_presence = self:get_myself():presence_name()

	if my_presence == "mission" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 10-10, warpins: 1 ---
		num_party_members_in_mission = num_party_members_in_mission + 1
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 11-15, warpins: 2 ---
	local members = self._other_members

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 16-23, warpins: 0 ---
	for _, member in ipairs(members) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 16-20, warpins: 1 ---
		local member_presence = member:presence_name()

		if member_presence == "mission" then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 21-21, warpins: 1 ---
			num_party_members_in_mission = num_party_members_in_mission + 1
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 22-23, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 24-24, warpins: 1 ---
	return num_party_members_in_mission
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager.hot_join_party_hub_server = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-16, warpins: 1 ---
	return Managers.backend.interfaces.matchmaker:fetch_queue_ticket_hub():next(function (response)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-6, warpins: 1 ---
		return Managers.grpc:hot_join_party_hub_server(response.ticket)
		--- END OF BLOCK #0 ---



	end):next(function (response)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if response.success then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 4-17, warpins: 1 ---
			_info("Hot joined hub session, response = " .. table.tostring(response, 3))

			return Promise.resolved(response.matched_hub_session_id)
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 18-23, warpins: 1 ---
			return Promise.rejected({
				error_details = response.failed_message
			})
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 24-24, warpins: 2 ---
		return
		--- END OF BLOCK #1 ---



	end)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.request_vivox_party_token = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-9, warpins: 1 ---
	return Managers.grpc:request_vivox_token(self:party_id(), "party")
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.game_session_in_progress = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local game_state = self:party_game_state()

	if game_state.status ~= "GAME_SESSION_IN_PROGRESS" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-8, warpins: 1 ---
		slot2 = false
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-9, warpins: 1 ---
		slot2 = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 10-10, warpins: 2 ---
	return slot2
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.join_game_session = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-13, warpins: 1 ---
	local game_session_id = self:current_game_session_id()

	assert(game_session_id, "game session id is missing")

	return Managers.multiplayer_session:party_immaterium_join_server(game_session_id)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.current_game_session_id = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local game_state = self:party_game_state()

	if game_state.status == "GAME_SESSION_IN_PROGRESS" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-10, warpins: 1 ---
		return game_state.game_session.game_session_id
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-12, warpins: 1 ---
		return nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 13-13, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.current_game_session_mission_data = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local game_state = self:party_game_state()

	if game_state.status == "GAME_SESSION_IN_PROGRESS" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-12, warpins: 1 ---
		return cjson.decode(game_state.params.mission_data)
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-14, warpins: 1 ---
		return nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 15-15, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.current_hub_server_session_id = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local game_state = self:party_game_state()

	if game_state.hub_session then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-10, warpins: 1 ---
		return game_state.hub_session.hub_session_id
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-12, warpins: 1 ---
		return nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 13-13, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager.latched_hub_server_matchmaking = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-20, warpins: 1 ---
	return Managers.backend.interfaces.matchmaker:fetch_queue_ticket_hub():next(function (response)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-6, warpins: 1 ---
		return Managers.grpc:latched_hub_server_matchmaking(response.ticket)
		--- END OF BLOCK #0 ---



	end):next(function (response)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-3, warpins: 1 ---
		if response.success then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 4-17, warpins: 1 ---
			_info("Hub Server Latched matchmaking, response = " .. table.tostring(response, 3))

			return Promise.resolved(response.matched_hub_session_id)
			--- END OF BLOCK #0 ---



		else

			-- Decompilation error in this vicinity:
			--- BLOCK #0 18-23, warpins: 1 ---
			return Promise.rejected({
				error_details = response.failed_message
			})
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 24-24, warpins: 2 ---
		return
		--- END OF BLOCK #1 ---



	end):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-10, warpins: 1 ---
		_error("Hub Server Latched matchmaking, error=" .. table.tostring(error, 3))

		return
		--- END OF BLOCK #0 ---



	end)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._table_tostring_or_string = function (self, table_or_string)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	if type(table_or_string) == "table" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-11, warpins: 1 ---
		return table.tostring(table_or_string, 3)
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-12, warpins: 1 ---
		return table_or_string
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 13-13, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._game_session_promise = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-10, warpins: 1 ---
	local game_session_promise = Promise:new()

	table.insert(self._game_session_promises, game_session_promise)

	return game_session_promise
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.wanted_mission_selected = function (self, backend_mission_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	local vote_state = self:party_vote_state()

	if vote_state.state == "ONGOING" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-12, warpins: 1 ---
		_info("Wanted mission rejected, already in process of booting a multiplayer session")

		return Promise.rejected()
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 13-29, warpins: 1 ---
	return Managers.voting:start_voting("mission_vote_matchmaking_immaterium", {
		backend_mission_id = backend_mission_id
	}):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-10, warpins: 1 ---
		_error("Could not start voting, error=" .. self:_table_tostring_or_string(error))

		return
		--- END OF BLOCK #0 ---



	end):next(function ()

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-4, warpins: 1 ---
		return self:_game_session_promise()
		--- END OF BLOCK #0 ---



	end)
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 30-30, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager.start_hub_group_up_vote = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	return Managers.voting:start_voting("new_hub_session_immaterium", {})
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.get_myself = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	return self._myself
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._mission_matchmaking_started = function (self, mission_name)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-1, warpins: 1 ---
	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._mission_matchmaking_completed = function (self, matched_game_session_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-1, warpins: 1 ---
	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._mission_matchmaking_aborted = function (self, reason)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-18, warpins: 1 ---
	local info_string = string.format("{#color(255,0,0)} Matchmaking failed, %s", reason)

	Managers.event:trigger("event_add_notification_message", "alert", info_string)
	_info("Mission Matchmaking aborted, fail reason: %s", reason)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.ready_voting_completed = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-1, warpins: 1 ---
	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager.invite_to_party = function (self, invitee_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local party_id = self:party_id()

	if party_id == "" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-9, warpins: 1 ---
		return Promise.rejected({
			error_details = "NOT_IN_A_PARTY"
		})
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 10-26, warpins: 1 ---
	return self:_get_presence_promise(invitee_account_id):next(function (presence_entry)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-5, warpins: 1 ---
		return self:_resolve_join_permission(presence_entry)
		--- END OF BLOCK #0 ---



	end):next(function ()

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-7, warpins: 1 ---
		return Managers.grpc:invite_to_party(party_id, invitee_account_id)
		--- END OF BLOCK #0 ---



	end):catch(function (error)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		_warn("could not invite, error=" .. table.tostring(error, 3))
		self:_on_invite_party_error(error.error_details)

		return Promise.rejected(error)
		--- END OF BLOCK #0 ---



	end)
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 27-27, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager.cancel_party_invite = function (self, invitee_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local party_id = self:party_id()

	if party_id == "" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-9, warpins: 1 ---
		return Promise.rejected({
			error_details = "NOT_IN_A_PARTY"
		})
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 10-16, warpins: 2 ---
	return Managers.grpc:cancel_invite_to_party(party_id, invitee_account_id)
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._decline_party_invite = function (self, party_id, answer_code)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	return Managers.grpc:cancel_invite_to_party(party_id, self._myself:account_id(), answer_code)
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._get_presence_promise = function (self, account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	local _, promise = Managers.presence:get_presence(account_id)

	return promise
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_member_joined = function (self, member_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:account_id() == member_account_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-7, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-16, warpins: 1 ---
	self:_get_presence_promise(member_account_id):next(function (presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		local message = Localize("loc_party_notification_member_joined", true, {
			member_character_name = presence:character_name()
		})

		Managers.event:trigger("event_add_notification_message", "default", message)

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 17-17, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._handle_member_left = function (self, member_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-9, warpins: 1 ---
	self:_get_presence_promise(member_account_id):next(function (presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		local message = Localize("loc_party_notification_member_left", true, {
			member_character_name = presence:character_name()
		})

		Managers.event:trigger("event_add_notification_message", "default", message)

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_member_kicked = function (self, member_account_id, reason)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	_info("party member %s was kicked for reason: %s", member_account_id, reason)
	self:_get_presence_promise(member_account_id):next(function (presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		local message = Localize("loc_party_notification_member_kicked", true, {
			member_character_name = presence:character_name()
		})

		Managers.event:trigger("event_add_notification_message", "default", message)

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_member_disconnected = function (self, member_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-9, warpins: 1 ---
	self:_get_presence_promise(member_account_id):next(function (presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		local message = Localize("loc_party_notification_member_disconnected", true, {
			member_character_name = presence:character_name()
		})

		Managers.event:trigger("event_add_notification_message", "default", message)

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_invite_created = function (self, invitee_account_id, inviter_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-1, warpins: 1 ---
	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_invite_canceled = function (self, invitee_account_id, inviter_account_id, canceler_account_id, answer_code)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:account_id() ~= inviter_account_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-7, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-9, warpins: 1 ---
	if answer_code and answer_code ~= "" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-23, warpins: 1 ---
		Managers.event:trigger("event_add_notification_message", "alert", LocalizedErrorCodes.loc_invite_error(answer_code))
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 24-31, warpins: 2 ---
		self:_get_presence_promise(invitee_account_id):next(function (invitee_presence)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-8, warpins: 1 ---
			local invitee_character_name = invitee_presence:character_name()
			local message = nil

			if invitee_account_id == canceler_account_id then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 9-16, warpins: 1 ---
				message = Localize("loc_party_notification_invite_declined", true, {
					invitee_character_name = invitee_character_name
				})
				--- END OF BLOCK #0 ---



			else

				-- Decompilation error in this vicinity:
				--- BLOCK #0 17-23, warpins: 1 ---
				message = Localize("loc_party_notification_invite_canceled", true, {
					invitee_character_name = invitee_character_name
				})
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 24-32, warpins: 2 ---
			Managers.event:trigger("event_add_notification_message", "default", message)

			return
			--- END OF BLOCK #1 ---



		end)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 32-33, warpins: 2 ---
	return
	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 34-34, warpins: 2 ---
	--- END OF BLOCK #3 ---



end

PartyImmateriumManager._handle_invite_timeout = function (self, invitee_account_id, inviter_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:account_id() ~= inviter_account_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-7, warpins: 1 ---
		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-16, warpins: 1 ---
	self:_get_presence_promise(invitee_account_id):next(function (invitee_presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		local message = Localize("loc_party_notification_invite_expired", true, {
			invitee_character_name = invitee_presence:character_name()
		})

		Managers.event:trigger("event_add_notification_message", "default", message)

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 17-17, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._handle_invite_accepted = function (self, invitee_account_id, inviter_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	if self._myself:account_id() ~= inviter_account_id then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-11, warpins: 1 ---
		self:_handle_member_joined(invitee_account_id)

		return
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 12-20, warpins: 1 ---
	self:_get_presence_promise(invitee_account_id):next(function (invitee_presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-18, warpins: 1 ---
		local message = Localize("loc_party_notification_invite_accepted", true, {
			invitee_character_name = invitee_presence:character_name()
		})

		Managers.event:trigger("event_add_notification_message", "default", message)

		return
		--- END OF BLOCK #0 ---



	end)

	return
	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 21-21, warpins: 2 ---
	--- END OF BLOCK #2 ---



end

PartyImmateriumManager._on_join_party = function (self, reconnect)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	if reconnect then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 3-8, warpins: 1 ---
		Log.info("PartyImmateriumManager", "Reconnected to strike team")
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-19, warpins: 1 ---
		Log.info("PartyImmateriumManager", "Joined new strike team")
		Managers.event:trigger("party_immaterium_join")
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 20-22, warpins: 2 ---
	self._cached_debug_get_parties_time = 9.7

	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._on_join_party_error = function (self, error_code)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	Managers.event:trigger("event_add_notification_message", "alert", LocalizedErrorCodes.loc_join_error(error_code))

	self._cached_debug_get_parties_time = 9.7

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_stay_in_party_voting_started = function (self, voting_id, new_party_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	slot3 = assert

	if self._new_party_id ~= nil then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-6, warpins: 1 ---
		slot4 = false
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-7, warpins: 1 ---
		slot4 = true
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-10, warpins: 2 ---
	slot3(slot4)

	self._new_party_id = new_party_id

	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._handle_stay_in_party_voting_completed = function (self, result)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	local new_party_id = self._new_party_id

	if result == "approved" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-13, warpins: 1 ---
		self:join_party(new_party_id)
		Log.info("PartyImmateriumManager", "stay_in_party_voting_completed -> joining new party %s", new_party_id)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 14-16, warpins: 2 ---
	self._new_party_id = nil

	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._handle_stay_in_party_voting_aborted = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	self._new_party_id = nil

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._on_invite_party_error = function (self, error_code)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	Managers.event:trigger("event_add_notification_message", "alert", LocalizedErrorCodes.loc_invite_error(error_code))

	self._cached_debug_get_parties_time = 9.7

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_immaterium_invite = function (self, party_id, inviter_account_id, expires_in_utc_sec)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-16, warpins: 1 ---
	Log.info("SocialService", "Got invite, party_id=%s, inviter_account_id=%s, expires_in_utc_sec=%i", party_id, inviter_account_id, expires_in_utc_sec)

	if self:current_state() == PartyConstants.State.in_mission then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 17-22, warpins: 1 ---
		self:_decline_party_invite(party_id, "IN_MISSION")
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 23-36, warpins: 1 ---
		self:_close_invite_popup(party_id)

		local _, promise = Managers.presence:get_presence(inviter_account_id)

		promise:next(function (inviter_presence)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-15, warpins: 1 ---
			return self:_resolve_join_permission(inviter_presence, "INVITE"):next(function ()

				-- Decompilation error in this vicinity:
				--- BLOCK #0 1-10, warpins: 1 ---
				local character_name = inviter_presence:character_name()
				local character_profile = inviter_presence:character_profile()

				if character_profile then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 11-11, warpins: 1 ---
					local character_level = character_profile.current_level
					--- END OF BLOCK #0 ---



				end

				--- END OF BLOCK #0 ---

				FLOW; TARGET BLOCK #1



				-- Decompilation error in this vicinity:
				--- BLOCK #1 12-14, warpins: 2 ---
				local player_name_and_level = nil

				if character_level then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 15-22, warpins: 1 ---
					player_name_and_level = Localize("loc_social_menu_character_name_format", true, {
						character_level = character_level,
						character_name = character_name
					})
					--- END OF BLOCK #0 ---



				end

				--- END OF BLOCK #1 ---

				FLOW; TARGET BLOCK #2



				-- Decompilation error in this vicinity:
				--- BLOCK #2 23-26, warpins: 2 ---
				local context = {
					title_text = "loc_social_party_invite_received_header",
					description_text = "loc_social_party_invite_received_description"
				}
				slot5 = {}

				if not player_name_and_level then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 27-27, warpins: 1 ---
					slot6 = character_name
					--- END OF BLOCK #0 ---



				end

				--- END OF BLOCK #2 ---

				FLOW; TARGET BLOCK #3



				-- Decompilation error in this vicinity:
				--- BLOCK #3 28-52, warpins: 2 ---
				slot5.player_name = slot6
				context.description_text_params = slot5
				context.options = {
					{
						text = "loc_social_party_invite_received_accept_button",
						close_on_pressed = true,
						hotkey = "confirm_pressed",
						callback = function ()

							-- Decompilation error in this vicinity:
							--- BLOCK #0 1-11, warpins: 1 ---
							self:join_party(party_id)

							self._invite_popups[party_id] = nil

							return
							--- END OF BLOCK #0 ---



						end
					},
					{
						text = "loc_social_party_invite_received_decline_button",
						close_on_pressed = true,
						hotkey = "back",
						callback = function ()

							-- Decompilation error in this vicinity:
							--- BLOCK #0 1-11, warpins: 1 ---
							self:_decline_party_invite(party_id)

							self._invite_popups[party_id] = nil

							return
							--- END OF BLOCK #0 ---



						end
					},
					{
						text = "loc_social_party_invite_received_decline_and_block_button",
						close_on_pressed = true,
						hotkey = "hotkey_menu_special_2",
						callback = function ()

							-- Decompilation error in this vicinity:
							--- BLOCK #0 1-19, warpins: 1 ---
							Managers.party_immaterium:_decline_party_invite(party_id)
							Managers.data_service.social:block_account(inviter_account_id)

							self._invite_popups[party_id] = nil

							return
							--- END OF BLOCK #0 ---



						end
					}
				}

				Managers.event:trigger("event_show_ui_popup", context, function (id)

					-- Decompilation error in this vicinity:
					--- BLOCK #0 1-5, warpins: 1 ---
					self._invite_popups[party_id] = id

					return
					--- END OF BLOCK #0 ---



				end)

				return
				--- END OF BLOCK #3 ---



			end):catch(function (error)

				-- Decompilation error in this vicinity:
				--- BLOCK #0 1-7, warpins: 1 ---
				self:_decline_party_invite(party_id, error.error_details)

				return
				--- END OF BLOCK #0 ---



			end)
			--- END OF BLOCK #0 ---



		end)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 37-38, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._handle_immaterium_invite_canceled = function (self, party_id, inviter_account_id, canceler_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-13, warpins: 1 ---
	Log.info("SocialService", "invite canceled, party_id=%s, inviter_account_id=%s, canceler_account_id=%s", party_id, inviter_account_id, canceler_account_id)
	self:_close_invite_popup(party_id)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_immaterium_invite_timeout = function (self, party_id, inviter_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	Log.info("SocialService", "invite timeout, party_id=%s, inviter_account_id=%s", party_id, inviter_account_id)
	self:_close_invite_popup(party_id)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._close_invite_popup = function (self, party_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	local popup = self._invite_popups[party_id]

	if popup then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-14, warpins: 1 ---
		Managers.event:trigger("event_remove_ui_popup", popup)

		self._invite_popups[party_id] = nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 15-15, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

PartyImmateriumManager._request_to_join_popup = function (self, joiner_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-22, warpins: 1 ---
	Log.info("SocialService", "Got invite, joiner_account_id=%s", joiner_account_id)
	self:_close_request_to_join_popup(joiner_account_id)

	local _, promise = Managers.presence:get_presence(joiner_account_id)

	promise:next(function (inviter_presence)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-8, warpins: 1 ---
		local character_name = inviter_presence:character_name()
		local character_profile = inviter_presence:character_profile()

		if character_profile then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 9-9, warpins: 1 ---
			local character_level = character_profile.current_level
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 10-12, warpins: 2 ---
		local player_name_and_level = nil

		if character_level then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-20, warpins: 1 ---
			player_name_and_level = Localize("loc_social_menu_character_name_format", true, {
				character_level = character_level,
				character_name = character_name
			})
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 21-24, warpins: 2 ---
		local context = {
			title_text = "loc_party_request_to_join_header",
			description_text = "loc_party_request_to_join_description"
		}
		slot6 = {}

		if not player_name_and_level then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 25-25, warpins: 1 ---
			slot7 = character_name
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #2 ---

		FLOW; TARGET BLOCK #3



		-- Decompilation error in this vicinity:
		--- BLOCK #3 26-50, warpins: 2 ---
		slot6.player_name = slot7
		context.description_text_params = slot6
		context.options = {
			{
				text = "loc_party_request_to_join_accept_button",
				close_on_pressed = true,
				hotkey = "confirm_pressed",
				callback = function ()

					-- Decompilation error in this vicinity:
					--- BLOCK #0 1-17, warpins: 1 ---
					Managers.grpc:answer_request_to_join(self:party_id(), joiner_account_id, "OK_POPUP")

					self._request_to_join_popups[joiner_account_id] = nil

					return
					--- END OF BLOCK #0 ---



				end
			},
			{
				text = "loc_party_request_to_join_decline_button",
				close_on_pressed = true,
				hotkey = "back",
				callback = function ()

					-- Decompilation error in this vicinity:
					--- BLOCK #0 1-17, warpins: 1 ---
					Managers.grpc:answer_request_to_join(self:party_id(), joiner_account_id, "MEMBER_DECLINED_REQUEST_TO_JOIN")

					self._request_to_join_popups[joiner_account_id] = nil

					return
					--- END OF BLOCK #0 ---



				end
			},
			{
				text = "loc_social_party_request_to_join_decline_and_block_button",
				close_on_pressed = true,
				hotkey = "hotkey_menu_special_2",
				callback = function ()

					-- Decompilation error in this vicinity:
					--- BLOCK #0 1-24, warpins: 1 ---
					Managers.grpc:answer_request_to_join(self:party_id(), joiner_account_id, "MEMBER_DECLINED_REQUEST_TO_JOIN")
					Managers.data_service.social:block_account(joiner_account_id)

					self._request_to_join_popups[joiner_account_id] = nil

					return
					--- END OF BLOCK #0 ---



				end
			}
		}

		Managers.event:trigger("event_show_ui_popup", context, function (id)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-5, warpins: 1 ---
			self._request_to_join_popups[joiner_account_id] = id

			return
			--- END OF BLOCK #0 ---



		end)

		return
		--- END OF BLOCK #3 ---



	end)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._handle_request_to_join_popup_cancel = function (self, joiner_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	Log.info("SocialService", " request to join canceled joiner_account_id=%s", joiner_account_id)
	self:_close_request_to_join_popup(joiner_account_id)

	return
	--- END OF BLOCK #0 ---



end

PartyImmateriumManager._close_request_to_join_popup = function (self, joiner_account_id)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-4, warpins: 1 ---
	local popup = self._request_to_join_popups[joiner_account_id]

	if popup then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 5-14, warpins: 1 ---
		Managers.event:trigger("event_remove_ui_popup", popup)

		self._request_to_join_popups[joiner_account_id] = nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 15-15, warpins: 2 ---
	return
	--- END OF BLOCK #1 ---



end

return PartyImmateriumManager
